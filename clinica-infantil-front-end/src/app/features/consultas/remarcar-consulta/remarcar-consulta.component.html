<div class="dashboard container my-5">
  <h2 class="fw-bold text-center text-md-start mb-4">Remarcar Consulta</h2>

  <!-- Mensagens de feedback (sucesso/erro) -->
  @if (successMessage) {
    <div class="alert alert-success text-center mb-4">
      {{ successMessage }}
    </div>
  }

  @if (errorMessage) {
    <div class="alert alert-danger text-center mb-4">
      {{ errorMessage }}
    </div>
  }

  <!-- Card com os detalhes atuais da consulta -->
  <div class="card p-4 mb-4 shadow-sm">
    <h4 class="card-title fw-bold">Consulta de {{ consulta?.paciente?.cliente?.nome }}</h4>
    <hr class="my-2">
    <p class="card-text mb-1">
      <strong>Médico:</strong> {{ consulta?.medico?.usuario?.funcionario?.nome }}
    </p>
    <p class="card-text mb-0">
      <strong>Data Atual:</strong> {{ consulta?.data_consulta | date:'dd/MM/yyyy' }}
      <br>
      <strong>Horário Atual:</strong> {{ consulta?.hora_inicio | slice:0:5 }} - {{ consulta?.hora_fim | slice:0:5 }}
    </p>
  </div>

  <!-- Formulário de remarcação com layout responsivo -->
  <form [formGroup]="remarcarForm" (ngSubmit)="onSubmit()">
    <div class="row g-3"> <!-- Usando 'g-3' para espaçamento consistente entre os campos -->
      <div class="col-12 col-md-6 mb-3">
        <label for="data_consulta" class="form-label">Nova Data</label>
        <input type="date" id="data_consulta" class="form-control" formControlName="data_consulta" [class.is-invalid]="remarcarForm.get('data_consulta')?.invalid && remarcarForm.get('data_consulta')?.touched">
        @if (remarcarForm.get('data_consulta')?.errors?.['required'] && remarcarForm.get('data_consulta')?.touched) {
          <div class="invalid-feedback">
            A data da consulta é obrigatória.
          </div>
        }
      </div>

      <div class="col-6 col-md-3 mb-3">
        <label for="hora_inicio" class="form-label">Hora de Início</label>
        <input type="time" id="hora_inicio" class="form-control" formControlName="hora_inicio" [class.is-invalid]="remarcarForm.get('hora_inicio')?.invalid && remarcarForm.get('hora_inicio')?.touched">
        @if (remarcarForm.get('hora_inicio')?.errors?.['required'] && remarcarForm.get('hora_inicio')?.touched) {
          <div class="invalid-feedback">
            A hora de início é obrigatória.
          </div>
        }
      </div>

      <div class="6 col-md-3 mb-3">
        <label for="hora_fim" class="form-label">Hora de Fim</label>
        <input type="time" id="hora_fim" class="form-control" formControlName="hora_fim" [class.is-invalid]="remarcarForm.get('hora_fim')?.invalid && remarcarForm.get('hora_fim')?.touched">
        @if (remarcarForm.get('hora_fim')?.errors?.['required'] && remarcarForm.get('hora_fim')?.touched) {
          <div class="invalid-feedback">
            A hora de fim é obrigatória.
          </div>
        }
      </div>
    </div>

    <div class="mt-4 d-flex flex-column flex-sm-row justify-content-end gap-2">
      <button type="submit" class="btn btn-primary w-sm-auto" [disabled]="remarcarForm.invalid || isLoading">
        @if (isLoading) {
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          Remarcando...
        } @else {
          Remarcar
        }
      </button>
      <app-botao-voltar texto="Voltar para a Lista" routerLink="../.." class="w-100 w-sm-auto"></app-botao-voltar>
    </div>
  </form>
</div>